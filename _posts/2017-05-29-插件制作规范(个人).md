---
permalink: /posts/spigot-plugin-normalizition
layout: post
title:  插件制作规范(个人)
categories: minecraft插件
tags:
---

* content
{:toc}

个人的一些插件制作规范,主要面向`微插件`.




## 微插件
受`微服务`与`npm`的影响,提出了微插件的概念.

微插件如其名,即小型化的插件,因为小插件可以组合成大插件,但大插件却没法拆出来用.

微插件有几个概念:

1. 一插件一模块: 一个插件内包含独立的模块,不要将多个模块放在一个插件里,哪怕属于同一个功能的多个模块.
2. 插件必须微小: 一个模块如果功能过于复杂,尝试拆成更细的子模块,每个子模块一个插件,让每个插件都成为微插件.
3. 共用: 将独立于模块的通用代码抽取出来放到新模块里,以便于其它插件引用,减少重复劳动.
4. 与具体主端版本联系紧密的代码应当独立成新项目,这样主端版本更新,与版本联系不紧密的那个插件就可以不用更新,`减少关注`内容.

## 规范

#### 完整独立
每个微插件项目都应该是完整独立的,虽然微小,但也不代表地位低,不要将多个插件一起更新处理,而要分开各自更新.

#### 版本发布
不需要一个提交对应一个版本,可以在提交多次后,确认新功能或bug修复没问题后再给指定的提交添加版本标签.

#### 项目文档
项目文档应当放在项目内,这样可以与代码同步提交,因为插件有自己的特殊性,即非最新版本的插件仍然可能被用到,因此对应老版本的文档同步也变得相当重要.

而如果文档不同步,只有最新的一份,那插件旧版本使用起来会相当困难.

文档格式不需要统一,目录结构不需要一致.推荐需要描述什么就添加什么,而不要为了套用格式而填入空的内容.并且格式应以美观,直观为主,不应为了格式而格式(如列表只有一项内容时,可以去掉列表直接写,再如父标题为标题3,子标题可以直接跳到标题5,因为标题4可能在视觉上跟标题3大小很接近,造成不直观)

#### 插件种类
MC的插件其实很简单,就是一个jar加描述文件,描述文件用来描述这个插件的信息以及提供入口来启动插件.

此外,如果用到第三方jar库,那第三方jar库就可以叫做前置lib了,因为它们不是MC插件,没有描述文件,因此不能放到插件目录,推荐放到服务端目录下的`lib`目录内,再做一个插件统一添加lib目录内的jar库到classpath

至于jar库数量太多,在lib内如何布局的问题,有几种形式,一种是直接所有jar包放lib目录内;一种是按功能来分,如与MC无关的jar包,与MC相关但比较通用的jar包,与MC某个版本联系密切的jar包;另一种是按包路径来分,如com.a.b.Test,就放在目录com/a/b下

至于前置lib有什么要求呢?

1. 不需要在服务器启动时启动的,而是被调用才生效的.
2. 仅仅添加前置lib而不调用不会对MC及其它插件造成任何影响,如果会造成影响,那应该做成插件.
3. 不会生成文件的.

#### 依赖要求
`前置lib`可以依赖前置lib,但不能依赖插件,并且前置lib的依赖不需要顺序,不需要软依赖.

`插件`则可以依赖插件与前置lib,插件对插件的依赖可以有顺序,可以有软依赖(这由MC本身插件机制实现),插件对前置lib的依赖不需要顺序,不需要软依赖.

#### 依赖最小化
虽然提倡微型化,但仍然推荐尽量减少依赖.

#### 依赖`Lib`
Lib插件是个特殊的存在,凡是需要调用前置lib内容的都需要依赖Lib插件(Lib插件会将这些前置lib添加到Classpath),
为了以防万一,所有插件都推荐添加依赖`Lib`,否则如果插件加载在Lib插件前可能导致前置lib类找不到异常.

#### 允许少量冗余
如果一个项目用到某个依赖非常少的方法,那么可以尝试将这少量代码`冗余`过去,这是允许并且推荐的!

但是如果冗余的代码逐渐增多,则应该改为依赖方式.

如果依赖的项目是非常流行常用的,那可以不冗余而直接依赖.

#### 优先级
一个功能应该做成哪种形式,应当遵循以下原则:

1. Lv.1 与MC无关的前置lib
2. Lv.2 与MC相关但比较通用的前置lib
3. Lv.3 与MC相关且与某个版本联系密切的前置lib
4. Lv.4 MC插件
